<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Collapsible sidebar using Bootstrap 4</title>

  

    <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="stylesheetResponsive.css">
    <link rel="stylesheet" href="https://unpkg.com/js-datepicker/dist/datepicker.min.css"> 

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>
</head>

<body>


    <!-- jQuery CDN - Slim version (=without AJAX) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>

    <!-- d3.JS -->
    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js"></script>
    <script type="text/javascript" src = "js/bootstrap.min.js"></script>
    <script src="//d3js.org/d3.geo.projection.v0.min.js"></script>
    <script src="//d3projection.js"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="data/CaliforniaCountiesOverdoses.json"></script>
    <script src="data/Chitown.json"></script>
    <script src="data/statesProj.json"></script>
    <script src="data/Counties_proj.json"></script>
    <script src="https://unpkg.com/leaflet-sidebar"></script>
    <script src="data/allSanFranciscoEvents13.json"></script>
    <script src="data/SFCounty_proj.json"></script>
    <script src="data/coworkingTenants_4.json"></script>
    <script src="data/coworkingTenants_5.json"></script>
    <script src="data/coworkingTenants_6.json"></script>
    <script src="data/coworkingTenants_9.json"></script>
    <script src="data/SanFrancisco_CoWorkingTenants.json"></script>
    <script src="js/d3.slider.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
    <script src="js/datepicker.min.js"></script>
    <script src="js/datepick.js"></script>
    <script src="https://unpkg.com/js-datepicker"></script> 


    <!-- Content Starts here -->

    <div class="wrapper">

        <!-- Sidebar -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3>Bootstrap Sidebar</h3>
            </div>

            <ul class="list-unstyled components">
                <p>Dummy Heading</p>
                <li class="active">
                    <a href="#homeSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Home</a>
                    <ul class="collapse list-unstyled" id="homeSubmenu">
                        <li>
                            <a href="#">Home 1</a>
                        </li> 
                        <li>
                            <a href="#">Home 2</a>
                        </li>
                        <li>
                            <a href="#">Home 3</a>
                        </li>
                    </ul>
                </li>
                <li>
                <a href="#pageSubmenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">Pages</a>
                <ul class="collapse list-unstyled" id="pageSubmenu">
                    <li>
                        <a href="#">Page 1</a>
                    </li>
                    <li>
                        <a href="#">Page 2</a>
                    </li>
                    <li>
                        <a href="#">Page 3</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="#">Portfolio</a>
            </li>
            <li>
                <a href="#">Contact</a>
            </li>
        </ul>

                <div id="datepicker"></div>

        </nav>

        <!-- Page Content -->
        <div id="content">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">

                    <button type="button" id="sidebarCollapse" class="btn btn-info">
                        <i class="fas fa-align-left"></i>
                        <span>Toggle Sidebar</span>
                    </button>

                </div>
            </nav>

            <!-- <div id="map" style="min-width: 100vh; min-height: 100vh; max-width: 100vh; max-height: 100vh" pointer-events="all">  -->

          

            <div class="line">
                <div id="map" style="min-width: 100vh; min-height: 100vh" >
            </div>

            <h2>Lorem Ipsum Dolor</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborumd.</p>

   

 
        </div>



    </div>


    <script>

    $(document).ready(function () {

    $('#sidebarCollapse').on('click', function () {
        $('#sidebar').toggleClass('active');
    });

});



    var value 
  //console.log(SFEvents)


    var currentValue = 10

    var sizeValue

    //Set values for time range slider
    var inputValue = null;
    var years = ["1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009", "2010","2011","2012","2013","2014","2015","2016","2017","2018","2019"];

    //Set values for lease-size range slider
    var sizeInputValue = 0;
    var leaseSizes = ["0","10000","20000","30000","40000", "50000","60000","70000","80000","90000","100000","110000","120000","130000","140000","140000","150000",
                     "160000","170000","180000","190000","200000","210000","220000","230000","240000","250000","260000","270000","280000","290000","300000"];

    var currentMap = d3.map();

    d3.queue()
    .defer(d3.csv, "data/statesProj.json", function(d) { 
        //console.log('s')
    })
    .defer(d3.csv, "data/coworkingTenants_4.json", function(d) { 
        //console.log('h')
    })

    .defer(d3.csv, "data/coworkingTenants_9.json", function(d) { 
        //console.log('h')
    })
    .defer(d3.csv, "data/SFCounty_proj.json", function(c) { 
       // console.log('c')
    })
    .defer(d3.csv, "data/SanFrancisco_CoWorkingTenants.json", function(cw) { 
       // console.log('cw')
    })
    .defer(d3.csv, "data/allSanFranciscoEvents13.json", function(cw) { 
       // console.log('cw')
    })
    .await(ready);

    function ready(error) {
    
    //var allSFEvents = SFEvents[0].concat(SFEvents[1]);
    //console.log(allSFEvents)
    //var outGeoJson = {}
    //outGeoJson['properties'] = allSFEvents
    //outGeoJson['type']= "Feature"
    //outGeoJson['geometry']= {"type": "Point", "coordinates":
    //[allSFEvents['latitude'], allSFEvents['longitude']]}

    //console.log(outGeoJson)

   // var coords = outGeoJson.features.geometry.coordinates;
    //console.log(coords)

    //outGeoJson.forEach(function(d) {
      //var coords = d.geometry.coordinates
      //console.log(coords)
      //d.latLong = new L.LatLng(coords[1],
                  //coords[0]);
    
    //})

//console.log(outGeoJson.properties)

//Object.keys(outGeoJson).forEach(function (key){
    //console.log(outGeoJson[key]);
//});
    var NationalData = coworkingTenantsNational.features
            //console.log(NationalData)


        // Create SVG

            //.attr("class", 'col-md-8 indexText')
            // .attr("transform", "translate(-200,-80)")

        //Create SVG
    
    
        //projection
        var albersProjection = d3.geoAlbers()
            .scale( 1200)
            .rotate ( [98.5795,] )
            .center( [0, 39.8283] )

        //GeoPath
        var geoPath = d3.geoPath()
            .projection( albersProjection );

        var geoPath2 = d3.geoPath()
            .projection( albersProjection );


    

        }


    d3.queue()
    
    .defer(d3.csv, "data/allSanFranciscoEvents13.json", function(d) { 
       // console.log('cw')
    })
    .await(readyLeaflet);


    // Build Leaflet Map
    function readyLeaflet(error) {

    var selectedDate



    const picker = datepicker(document.querySelector('#datepicker'), {


  // Event callbacks.
  onSelect: function(instance) {
    
    
   // var dateAsString = dateText; //the first parameter of this function
      
    //console.log(instance)
    // Show which date was selected.
    
    //instance.dateSelected.toString()
    //instance.dateSelected.split(" " ,4)
    var instanceSplit = instance.dateSelected.toString().split(" " ,4)
    //console.log(instanceSplit);
    var instanceClean = instanceSplit.toString().replace(/,/g, ' ')
    //console.log(instanceClean)
    selectedDate = instanceClean
    update()
    if (instanceClean === 'Mon Feb 18 2019') {
                console.log('yes, datematch!')
                return 'blue'
            }
        //sconsole.log(selectedDate)
       
  },
  onShow: function(instance) {
    console.log('Calendar showing.');
  },
  onHide: function(instance) {
    console.log('Calendar hidden.');
  },
  onMonthChange: function(instance) {
    // Show the month of the selected date.
    console.log(instance.currentMonthName);
  },
 
 
 
  // Customizations.
  formatter: function(el, date, instance) {
    // This will display the date as `1/1/2019`.
    el.value = date.toDateString();
  },
  position: 'tr', // Top right.
  startDay: 1, // Calendar week starts on a Monday.
  customDays: ['S', 'M', 'T', 'W', 'Th', 'F', 'S'],
  customMonths: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
  overlayButton: 'Go!',
  overlayPlaceholder: 'Enter a 4-digit year',
 
  // Settings.
  alwaysShow: true, // Never hide the calendar.
  dateSelected: new Date(), // Today is selected.
  maxDate: new Date(2099, 0, 1), // Jan 1st, 2099.
  minDate: new Date(2016, 5, 1), // June 1st, 2016.
  startDate: new Date(), // This month.
 
  
  // Disabling things.


  
});
    
    function dateMatch(data){
        //console.log(selectedDate)
    if (selectedDate === data.dateFormatted) {
        //console.log(data.dateFormatted)
        console.log("selectedDate is: " + selectedDate+ " and dateFormatted is: "+data.dateFormatted)
        return '.4'
    } else {
       return '0'
    }
}


     function initialdateMatch(data){
        //console.log(selectedDate)
    if (selectedDate === data.dateFormatted) {
        //console.log(data.dateFormatted)
        console.log("selectedDate is: " + selectedDate+ " and dateFormatted is: "+data.dateFormatted)
        return '.4'
    } else {
       return '0'
    }
}

    function setPopups(data){
        //console.log(selectedDate)
    if (selectedDate === data.dateFormatted) {
        console.log('pointer events disabled')
        return 'all'
    } else {
       return 'none'
    }
}
    //var SFData = SFCoworking.features
        //console.log(SFData)
    var allSFEvents

    function combineArray(arr) {
    allSFEvents = [];
    for (var i = 0; i < arr.length; i++) {
        allSFEvents = allSFEvents.concat(arr[i]);
    }
     
    return allSFEvents;

}

combineArray(SFEvents);
//console.log(allSFEvents)

    //var SFData = SFCoworking.features
        
    //var allSFEvents = SFEvents[0].concat(SFEvents[1]);
    
    

    //console.log(outGeoJson)

   // var coords = outGeoJson.features.geometry.coordinates;
    //console.log(coords)

    //outGeoJson.forEach(function(d) {
      //var coords = d.geometry.coordinates
      //console.log(coords)
      //d.latLong = new L.LatLng(coords[1],
                  //coords[0]);
    
    //})

//console.log(outGeoJson.properties)



        var radius = d3.scaleLinear()
            .domain([20000, 40000, 60000, 80000, 100000]) //568158 37691912
            .range([8, 10, 12, 14, 16]);


        var type = d3.scaleOrdinal()
            .domain(['WeWork', 'Regus', 'Spaces', 'Knotel', 'RocketSpace', 'HQ Global Workplaces'])
            .range(['#e30613', '#17a2b8', '#28a745', '#6610f2', '#ffc107', '#ed700a'])
             .unknown("white");


        //Read in coworking data
        var SFData = nationalCoworkingTenantsLeaflet.features
            //console.log(SFData)
    //var SanFranciscoEvents = outGeoJson.features
    //console.log(outGeoJson)
        //Build Leaflet Map
        L.mapbox.accessToken = 'pk.eyJ1Ijoic3RhcnJtb3NzMSIsImEiOiJjaXFheXZ6ejkwMzdyZmxtNmUzcWFlbnNjIn0.IoKwNIJXoLuMHPuUXsXeug';
        var mapboxUrl = 'https://api.mapbox.com/styles/v1/mapbox/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}';
            //var accessToken = 'pk.eyJ1Ijoic3RhcnJtb3NzMSIsImEiOiJjam13ZHlxbXgwdncwM3FvMnJjeGVubjI5In0.-ridMV6bkkyNhbPfMJhVzw';
        var map = L.map('map').setView([37.7749, -122.4194], 13);

                mapLink = 
            '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
            'https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/{z}/{x}/{y}?access_token=' + L.mapbox.accessToken, {
                tileSize: 512,
                zoomOffset: -1,
                attribution: '© <a href="https://www.mapbox.com/feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);
        
        setTimeout(function(){ map.invalidateSize()}, 400);
        var svgLayer = L.svg()
            svgLayer.addTo(map);

     
            
        var svgMap = d3.select("#map").select("svg");
            var mapG = svgMap.select('g');

    

        var LeafletDiv = d3.select("body").append("div")   
            .attr("class", "county2014Tooltip")               
            .style("opacity", 0)
        //.style("left", (d3.event.pageX) + "px")     
        //.style("top", (d3.event.pageY - 28) + "px");
            
      //un-comment this for map to load!
        //d3.json("data/coworkingTenants_9.json", function(SFData) {
            //var SFData = nationalCoworkingTenantsLeaflet.features
            //})

        //var coords = SFData.geometry.coordinates;
        //console.log(coords)
     //var item = outGeoJson.properties[1].location.geo.latitude
     //console.log(item)

     
        var tenantNamesArray = []
        var agencyBrokerNamesArray = []
        allSFEvents.forEach(function(d) {
     
      d.latLong = new L.LatLng(d.location.geo.latitude,
                  d.location.geo.longitude);
      //console.log(d.latLong)
      })
            
 
    SFData.forEach(function(d) {
      var coords = d.geometry.coordinates
      //console.log(coords)
      d.latLong = new L.LatLng(coords[1],
                  coords[0]);

      var tenantNames = d.properties.Tenant
      
      tenantNamesArray.push(tenantNames)

      var agencyBrokerNames = d.properties.Agency_Bro
      
      agencyBrokerNamesArray.push(agencyBrokerNames)
      
      
      //console.log(tenantNames)
      return tenantNames;

      
      
      
      //console.log(tenantNames)
      //console.log(agencyBrokerNames)
      return agencyBrokerNames
    
    })

    //console.log(allSFEvents)

    var events = mapG.selectAll("circle")
        .data(allSFEvents)
        .enter().append("circle")
        .style("stroke", "black")
        .attr("class", 'events')
        .style("fill", '#ffba00')
        .style("opacity", '0')
        .attr("r", 4.5)
        
        .style("pointer-events", "all")

    var todaysDate = new Date 

   
 
    //console.log(events)
      
    function drawAndUpdateEventCircles() {
        events.attr("transform",
            function(d) {
                var layerPoints = map.latLngToLayerPoint(d.latLong);
                //console.log(d.latLong)
                return "translate("+ layerPoints.x +","+ layerPoints.y +")";
            }
        )
    }
drawAndUpdateEventCircles();
      map.on("moveend", drawAndUpdateEventCircles);

    var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    
    var today  = new Date();
    var todayString = today.toString().split(" " ,4)
    var todayClean = todayString.toString().replace(/,/g, ' ')
    console.log(todayClean)



//console.log(today.toLocaleDateString("en-US")); // 9/17/2016
//console.log(today.toLocaleDateString("en-US", options)); // Saturday, September 17, 2016
//console.log(today.toLocaleDateString("hi-IN", options));


function update(value) {
    
    d3.selectAll(".events")
        .style("opacity", dateMatch)
        //.style("pointer-events", setPopups);
}

var date
    d3.selectAll(".events").each(function(d) {
            var options = { weekday: 'long'};
            var date = new Date(d.startDate)
            var dateString = date.toString()
            //console.log(dateString)
            //date.toLocaleDateString()
            var dateSplit = dateString.split(" " ,4)
            var dateClean = dateSplit.toString().replace(/,/g, ' ')
            //console.log(date.split(' '))
            //dateSplit = date.split(/ (.*)/);
            //console.log(dateSplit)
            d.dateFormatted = dateClean
            return date

        });

    //console.log(d.dateFormatted)

    d3.selectAll(".events")
          .on("mouseover", function(d) { 

            //console.log(d.dateFormatted)
            //console.log(d.startDate)
            //var options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            //d.startDate = new Date()
            //console.log(new Date(d.startDate))
            //console.log(new Date(d.startDate).toLocaleDateString("en-US", options))    

          
            //console.log(d.startDate.toLocaleDateString("en-US", options))

  
            
            var value2014 = currentMap.get(d.location);     
                  LeafletDiv.transition()        
                     .duration(200)      
                    .style("opacity", .9);

                  LeafletDiv .html('<br/>' + '<b>'+d.location.name+'</b>' + '<br/>'+d.name
                    + '<br/>'+d.dateFormatted
                    )
                    .style("left", (d3.event.pageX+ 15) + "px")     
                    .style("top", (d3.event.pageY - 150) + "px")
                    .style("text-align", 'left'); 
                   d3.select(this).attr("class","countyHover");   
              })

              .on("mouseout", function(d) {       
                LeafletDiv.transition()        
                  .duration(200)      
                  .style("opacity", 0);  
                d3.select(this).attr("class","features"); 
              });  

    


}



    </script>


</body>

</html>