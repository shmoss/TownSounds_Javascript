<!DOCTYPE html>
<html>
  <head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <title>Town Sounds</title>

    <!-- bulma css-->
    <link rel="stylesheet"  type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.3.2/css/bulma.min.css">

    <!-- CSS stylesheet -->
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
     <link rel="stylesheet" type="text/css" href="leaflet-sidebar.css">
     <link 
        rel="stylesheet" 
        href="http://cdn.leafletjs.com/leaflet-0.7/leaflet.css"
    >
    <link href='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.css' rel='stylesheet' />

    <!-- D3.js CDN source -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="http://d3js.org/d3.v4.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src = "js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/bootstrap-theme.min.css" />
    <script src="//d3js.org/d3.geo.projection.v0.min.js"></script>
    <script src="//d3projection.js"></script>
    <script src="//d3js.org/topojson.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="data/CaliforniaCountiesOverdoses.json"></script>
    <script src="data/Chitown.json"></script>
    <script src="data/statesProj.json"></script>
    <script src="data/Counties_proj.json"></script>
      <script src="https://unpkg.com/leaflet-sidebar"></script>
      <script src="data/allSanFranciscoEvents13.json"></script>
    <script src="data/SFCounty_proj.json"></script>
    <script src="data/coworkingTenants_4.json"></script>
    <script src="data/coworkingTenants_5.json"></script>
     <script src="data/coworkingTenants_6.json"></script>
     <script src="data/coworkingTenants_9.json"></script>
    <script src="data/SanFrancisco_CoWorkingTenants.json"></script>
    <script src="js/d3.slider.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.3.1/leaflet.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/v3.1.1/mapbox.js'></script>
    <script src='data/leaflet-sidebar.js'></script>
    <script src='data/leaflet-sidebar.min.js'></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  

  </head>
  
  <body style ='background-color:#f8f9fa'>

    

    <div id="map" style="width: 100%; height: 100%; position:absolute;" pointer-events="all">  
 
   
    
    		
  
    



			

<script>

//first commit!!
	//.domain(['WeWork', 'Regus', 'Spaces', 'Knotel', 'RocketSpace', 'HQ Global Workplaces'])
     //		.range(['#e30613', '#17a2b8', '#28a745', '#6610f2', '#ffc107', '#ed700a'])
     	


 	var value 
  //console.log(SFEvents)


 	var currentValue = 10

 	var sizeValue

 	//Set values for time range slider
    var inputValue = null;
    var years = ["1993","1994","1995","1996","1997","1998","1999","2000","2001","2002","2003","2004","2005","2006","2007","2008","2009", "2010","2011","2012","2013","2014","2015","2016","2017","2018","2019"];

    //Set values for lease-size range slider
    var sizeInputValue = 0;
    var leaseSizes = ["0","10000","20000","30000","40000", "50000","60000","70000","80000","90000","100000","110000","120000","130000","140000","140000","150000",
    				 "160000","170000","180000","190000","200000","210000","220000","230000","240000","250000","260000","270000","280000","290000","300000"];

    var currentMap = d3.map();

    d3.queue()
    .defer(d3.csv, "data/statesProj.json", function(d) { 
        //console.log('s')
    })
    .defer(d3.csv, "data/coworkingTenants_4.json", function(d) { 
        //console.log('h')
    })

    .defer(d3.csv, "data/coworkingTenants_9.json", function(d) { 
        //console.log('h')
    })
    .defer(d3.csv, "data/SFCounty_proj.json", function(c) { 
       // console.log('c')
    })
    .defer(d3.csv, "data/SanFrancisco_CoWorkingTenants.json", function(cw) { 
       // console.log('cw')
    })
    .defer(d3.csv, "data/allSanFranciscoEvents13.json", function(cw) { 
       // console.log('cw')
    })
 	.await(ready);

 	function ready(error) {
    
    //var allSFEvents = SFEvents[0].concat(SFEvents[1]);
    //console.log(allSFEvents)
    //var outGeoJson = {}
    //outGeoJson['properties'] = allSFEvents
    //outGeoJson['type']= "Feature"
    //outGeoJson['geometry']= {"type": "Point", "coordinates":
    //[allSFEvents['latitude'], allSFEvents['longitude']]}

    //console.log(outGeoJson)

   // var coords = outGeoJson.features.geometry.coordinates;
    //console.log(coords)

    //outGeoJson.forEach(function(d) {
      //var coords = d.geometry.coordinates
      //console.log(coords)
      //d.latLong = new L.LatLng(coords[1],
                  //coords[0]);
    
    //})

//console.log(outGeoJson.properties)

//Object.keys(outGeoJson).forEach(function (key){
    //console.log(outGeoJson[key]);
//});
    var NationalData = coworkingTenantsNational.features
     		//console.log(NationalData)


		// Create SVG

   		 	//.attr("class", 'col-md-8 indexText')
   		 	// .attr("transform", "translate(-200,-80)")

     	//Create SVG
	
	
 		//projection
 	 	var albersProjection = d3.geoAlbers()
    		.scale( 1200)
    		.rotate ( [98.5795,] )
    		.center( [0, 39.8283] )

    	//GeoPath
  		var geoPath = d3.geoPath()
    		.projection( albersProjection );

    	var geoPath2 = d3.geoPath()
    		.projection( albersProjection );


    

		}


	d3.queue()
    
    .defer(d3.csv, "data/allSanFranciscoEvents13.json", function(d) { 
       // console.log('cw')
    })
 	.await(readyLeaflet);


 	// Build Leaflet Map
    function readyLeaflet(error) {

    console.log(SFEvents)
    console.log(SFEvents.length)
    //var SFData = SFCoworking.features
        //console.log(SFData)
    var allSFEvents

    function combineArray(arr) {
    allSFEvents = [];
    for (var i = 0; i < arr.length; i++) {
        allSFEvents = allSFEvents.concat(arr[i]);
    }
     console.log(allSFEvents)
    return allSFEvents;

}

combineArray(SFEvents);
console.log(allSFEvents)

    //var SFData = SFCoworking.features
        
    //var allSFEvents = SFEvents[0].concat(SFEvents[1]);
    
    

    //console.log(outGeoJson)

   // var coords = outGeoJson.features.geometry.coordinates;
    //console.log(coords)

    //outGeoJson.forEach(function(d) {
      //var coords = d.geometry.coordinates
      //console.log(coords)
      //d.latLong = new L.LatLng(coords[1],
                  //coords[0]);
    
    //})

//console.log(outGeoJson.properties)



 		var radius = d3.scaleLinear()
    		.domain([20000, 40000, 60000, 80000, 100000]) //568158 37691912
      		.range([8, 10, 12, 14, 16]);


    	var type = d3.scaleOrdinal()
      		.domain(['WeWork', 'Regus', 'Spaces', 'Knotel', 'RocketSpace', 'HQ Global Workplaces'])
     		.range(['#e30613', '#17a2b8', '#28a745', '#6610f2', '#ffc107', '#ed700a'])
     		 .unknown("white");


 		//Read in coworking data
 		var SFData = nationalCoworkingTenantsLeaflet.features
     		//console.log(SFData)
    //var SanFranciscoEvents = outGeoJson.features
    //console.log(outGeoJson)
 		//Build Leaflet Map
        L.mapbox.accessToken = 'pk.eyJ1Ijoic3RhcnJtb3NzMSIsImEiOiJjaXFheXZ6ejkwMzdyZmxtNmUzcWFlbnNjIn0.IoKwNIJXoLuMHPuUXsXeug';
        var mapboxUrl = 'https://api.mapbox.com/styles/v1/mapbox/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}';
            //var accessToken = 'pk.eyJ1Ijoic3RhcnJtb3NzMSIsImEiOiJjam13ZHlxbXgwdncwM3FvMnJjeGVubjI5In0.-ridMV6bkkyNhbPfMJhVzw';
        var map = L.map('map').setView([37.7749, -122.4194], 13);

        		mapLink = 
            '<a href="http://openstreetmap.org">OpenStreetMap</a>';
        L.tileLayer(
   			'https://api.mapbox.com/styles/v1/mapbox/dark-v9/tiles/{z}/{x}/{y}?access_token=' + L.mapbox.accessToken, {
       			tileSize: 512,
        		zoomOffset: -1,
        		attribution: '© <a href="https://www.mapbox.com/feedback/">Mapbox</a> © <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    	}).addTo(map);
     	
        setTimeout(function(){ map.invalidateSize()}, 400);
   		var svgLayer = L.svg()
			svgLayer.addTo(map);

     
			
		var svgMap = d3.select("#map").select("svg");
			var mapG = svgMap.select('g');

    

		var LeafletDiv = d3.select("body").append("div")   
    		.attr("class", "county2014Tooltip")               
    		.style("opacity", 0)
    	//.style("left", (d3.event.pageX) + "px")     
    	//.style("top", (d3.event.pageY - 28) + "px");
			
      //un-comment this for map to load!
		//d3.json("data/coworkingTenants_9.json", function(SFData) {
        	//var SFData = nationalCoworkingTenantsLeaflet.features
        	//})

		//var coords = SFData.geometry.coordinates;
		//console.log(coords)
     //var item = outGeoJson.properties[1].location.geo.latitude
     //console.log(item)

     
		var tenantNamesArray = []
		var agencyBrokerNamesArray = []
		allSFEvents.forEach(function(d) {
     
      d.latLong = new L.LatLng(d.location.geo.latitude,
                  d.location.geo.longitude);
      //console.log(d.latLong)
      })
			
 
    SFData.forEach(function(d) {
      var coords = d.geometry.coordinates
      //console.log(coords)
      d.latLong = new L.LatLng(coords[1],
                  coords[0]);

      var tenantNames = d.properties.Tenant
      
      tenantNamesArray.push(tenantNames)

      var agencyBrokerNames = d.properties.Agency_Bro
      
      agencyBrokerNamesArray.push(agencyBrokerNames)
      
      
      //console.log(tenantNames)
      return tenantNames;

      
      
      
      //console.log(tenantNames)
      //console.log(agencyBrokerNames)
      return agencyBrokerNames
    
    })

    //console.log(allSFEvents)

    var events = mapG.selectAll("circle")
        .data(allSFEvents)
        .enter().append("circle")
        .style("stroke", "blue")
        .attr("class", 'events')
        .style("fill", '#ffba00')
        .style("opacity",.3)
        .attr("r", 4.5)
        .style("display", "all")
        .style("pointer-events", "all")

        
 
        console.log(events)
      
    function drawAndUpdateEventCircles() {
        events.attr("transform",
            function(d) {
                var layerPoints = map.latLngToLayerPoint(d.latLong);
                //console.log(d.latLong)
                return "translate("+ layerPoints.x +","+ layerPoints.y +")";
            }
        )
    }
drawAndUpdateEventCircles();
      map.on("moveend", drawAndUpdateEventCircles);


    d3.selectAll(".events")
          .on("mouseover", function(d) { 
            console.log(d.location)

  
            
            var value2014 = currentMap.get(d.location);     
                  LeafletDiv.transition()        
                     .duration(200)      
                    .style("opacity", .9);

                  LeafletDiv .html('<br/>' + '<b>'+d.name+'</b>' + '<br/>'+d.location.name
                    + '<br/>'+d.startDate.toString() 
                    )
                    .style("left", (d3.event.pageX+ 15) + "px")     
                    .style("top", (d3.event.pageY - 150) + "px")
                    .style("text-align", 'left'); 
                   d3.select(this).attr("class","countyHover");   
              })

              .on("mouseout", function(d) {       
                LeafletDiv.transition()        
                  .duration(200)      
                  .style("opacity", 0);  
                d3.select(this).attr("class","features"); 
              });  

//console.log(tenantNamesArray)
	//console.log(agencyBrokerNamesArray)	
		/*
		function tenantNamesArrayRemove(array){

			return array.filter(function(ele){
				console.log(ele)
				return ele !== 'WeWork' || ele !== "Regus"
			})

		}
*/
		//tenantNamesArrayRemove(tenantNamesArray)



	
			//this does work
			//d3.selectAll(".features").style("opacity", .1)





//Build 'Select All' Checkbox
	
	// Listen for click on toggle checkbox

	


}

		


    </script>
  </body>
</html>